# PRD.md: AI T-Rex Runner Automator

---

## 1. 프로젝트 개요 (Project Overview)

본 프로젝트는 웹 브라우저 기반의 **T-Rex Runner 게임**을 컴퓨터 비전 및 강화 학습(선택 사항)을 활용하여 인간의 개입 없이 자동으로 플레이하고, 고득점을 달성하는 소프트웨어를 개발하는 것을 목표로 함.

---

## 2. 문제 정의 (The Problem)

### 핵심 과제
실시간으로 변하는 게임 환경(장애물의 거리, 높이, 속도)을 데이터로 변환하고, **0.1초 미만의 지연 시간(Latency)** 내에 최적의 행동(Jump, Duck, Stay)을 결정해야 함.

### 제1원칙 기반 분해

| 구분 | 설명 |
|------|------|
| **State (상태)** | 화면상의 픽셀 데이터 → 장애물과의 거리, 속도 |
| **Action (행동)** | 키보드 입력 (`Space`, `↓`) |
| **Goal (목표)** | 충돌 직전의 픽셀 변화를 감지하여 생존 시간을 극대화함 |

---

## 3. 핵심 기능 요구사항 (Key Functional Requirements)

### 3.1. 화면 인식 시스템 (Vision System)

- **실시간 캡처**: 초당 최소 30프레임(FPS) 이상의 속도로 게임 캔버스 영역을 스캔해야 함.
- **장애물 탐지**: 선인장(낮은/높은/군집)과 익룡(높이별)을 구분하고 공룡과의 수평 거리를 계산해야 함.
- **속도 추정**: 게임이 진행됨에 따라 배경이 흐르는 속도 혹은 프레임 간 장애물 이동 거리를 계산하여 가속도를 측정해야 함.

### 3.2. 의사결정 엔진 (Decision Engine)

- **임계값 제어 (v1.0)**: 장애물과의 거리가 `D < f(Speed)` 일 때 점프/숙기 명령 하달.
- **적응형 로직**: 게임 속도가 빨라짐에 따라 반응하는 거리 임계값을 동적으로 확장.

### 3.3. 컨트롤러 인터페이스 (Controller)

- **저지연 입력**: Python의 기본 라이브러리보다 빠른 입력 도구(예: PyDirectInput)를 사용하여 브라우저에 신호 전달.

---

## 4. 기술 스택 (Technical Stack)

| 구분 | 기술 / 라이브러리 | 이유 |
|------|-------------------|------|
| **언어** | Python 3.10+ | 강력한 비전/AI 생태계 보유 |
| **이미지 처리** | OpenCV, MSS | 빠른 화면 캡처 및 전처리 (Grayscale, Canny Edge) |
| **제어** | PyDirectInput | DirectX 기반 게임에서도 작동하는 저지연 키보드 시뮬레이션 |
| **강화 학습 (Optional)** | Stable Baselines3 (PPO/DQN) | 스스로 학습하는 지능형 에이전트 구축 시 사용 |

---

## 5. 상세 설계 로직 (Logic Flow)

```
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│   화면 캡처      │ ──▶ │   전처리        │ ──▶ │   장애물 탐지    │
│   (MSS)         │     │   (OpenCV)      │     │   (ROI 분석)    │
└─────────────────┘     └─────────────────┘     └─────────────────┘
                                                        │
                                                        ▼
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│   키 입력        │ ◀── │   행동 결정      │ ◀── │   거리/속도 계산 │
│   (PyDirectInput)│     │   (Jump/Duck)   │     │                 │
└─────────────────┘     └─────────────────┘     └─────────────────┘
```

### 주요 처리 단계

1. **전처리 (Preprocessing)**
   - 컬러 화면을 흑백으로 변환
   - 노이즈를 제거하여 장애물의 윤곽선만 추출

2. **검색 창 (Search Window)**
   - 공룡 바로 앞 특정 영역(ROI, Region of Interest)을 설정
   - 해당 영역에 '검은색 픽셀'이 나타나는지 감시

3. **동적 보정**
   - 게임 시간이 길어질수록 Search Window의 가로 길이를 오른쪽으로 길게 늘림
   - 속도 증가에 대비

---

## 6. 단계별 로드맵 (Roadmap)

### Phase 1: MVP (Minimum Viable Product)
> 단순 픽셀 감지 기반 점프 구현

- [ ] 화면 캡처 모듈 구현
- [ ] 기본 장애물 감지 로직
- [ ] 점프 명령 전송
- **목표**: 고정된 속도에서 선인장 10개 이상 통과

### Phase 2: 고도화 (Optimization)
> 익룡 탐지 및 정밀 보정

- [ ] 익룡(Pterodactyl) 탐지 및 숙기(`↓`) 기능 추가
- [ ] 게임 속도(Pixel per Frame) 계산
- [ ] 점프 타이밍 정밀 보정
- **목표**: 다양한 장애물에 대응

### Phase 3: 지능화 (Intelligence)
> 강화 학습 기반 자율 에이전트

- [ ] Reinforcement Learning 환경 구축 (OpenAI Gym 커스텀 환경)
- [ ] 인간의 기록을 넘어서는 초고속 단계에서의 생존 학습
- **목표**: 자가 학습을 통한 성능 향상

---

## 7. 성공 지표 (Success Metrics)

| 지표 | 목표 값 |
|------|---------|
| **평균 점수** | 5,000점 이상 달성 |
| **처리 지연 시간** | 화면 캡처 → 키 입력까지 50ms 이하 유지 |

---

## 참고 사항

- 본 프로젝트는 교육 및 연구 목적으로 개발됨
- Chrome 브라우저의 오프라인 T-Rex 게임(`chrome://dino`)을 대상으로 함
